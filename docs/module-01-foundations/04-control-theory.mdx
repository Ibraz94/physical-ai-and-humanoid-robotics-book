---
title: Control Theory
sidebar_position: 4
---

# Control Theory for Humanoids

**Learning Objectives**
- Implement a PID controller in Python.
- Understand feedback loops.
- Apply control to a simulated joint.

## PID Controller Class

The Proportional-Integral-Derivative controller is fundamental.

```python
class PID:
    def __init__(self, Kp, Ki, Kd):
        self.Kp = Kp
        self.Ki = Ki
        self.Kd = Kd
        self.prev_error = 0
        self.integral = 0

    def update(self, setpoint, measured_value, dt):
        error = setpoint - measured_value
        self.integral += error * dt
        derivative = (error - self.prev_error) / dt
        output = (self.Kp * error) + (self.Ki * self.integral) + (self.Kd * derivative)
        self.prev_error = error
        return output
```

## Simulation Loop

Simulating a joint responding to the controller.

```python
import time

def simulate_joint():
    pid = PID(1.0, 0.1, 0.05)
    target_angle = 90.0
    current_angle = 0.0
    dt = 0.1

    for _ in range(50):
        control_signal = pid.update(target_angle, current_angle, dt)
        # Simple plant model: angle changes by control signal * dt
        current_angle += control_signal * dt
        print(f"Target: {target_angle}, Current: {current_angle:.2f}")
        time.sleep(0.01)
```

## ROS 2 Integration

Using PID inside a ROS Node.

```python
class JointController(Node):
    def __init__(self):
        super().__init__('joint_controller')
        self.pid = PID(1.0, 0.0, 0.0)
        # ... subscriber to joint_states, publisher to joint_commands ...
```
